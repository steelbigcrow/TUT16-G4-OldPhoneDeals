<div class="container-fluid py-4">
  <!-- Loading Spinner -->
  <div *ngIf="isLoadingPhone" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Phone Detail Content -->
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div *ngIf="!isLoadingPhone && phone">
        <button (click)="goToHome()" class="btn btn-outline-secondary mb-4">
          <i class="bi bi-arrow-left me-1"></i> Back
        </button>

        <div class="row">
          <!-- Phone Image -->
          <div class="col-12 col-md-4 text-center mb-3 mb-md-0">
            <img *ngIf="phone.image" [src]="getImageUrl(phone.image)" [alt]="phone.title" class="img-fluid rounded shadow-sm" style="max-height: 400px; object-fit: contain;">
            <div *ngIf="!phone.image && !isLoadingPhone" class="img-fluid rounded shadow-sm bg-light d-flex align-items-center justify-content-center" style="max-height: 400px; height: 300px; width: 100%;">
              <span>No Image Available</span>
            </div>
          </div>

          <!-- Phone Details -->
          <div class="col-12 col-md-8">
            <div class="card shadow-sm h-100">
              <div class="card-body">
                <h2 class="mb-3">{{ phone.title }}</h2>
                <div class="d-flex flex-wrap justify-content-between mb-3">
                  <div>
                    <span class="badge bg-secondary me-2">Brand: {{ phone.brand }}</span>
                    <span class="badge bg-success me-2" *ngIf="phone.stock > 0">In Stock: {{ phone.stock }}</span>
                    <span class="badge bg-danger" *ngIf="phone.stock === 0">Out of Stock</span>
                  </div>
                  <h3 class="text-primary">${{ phone.price.toFixed(2) }}</h3>
                </div>

                <p class="text-muted">Seller: {{ phone.seller?.firstName }} {{ phone.seller?.lastName }}</p>

                <!-- Action buttons -->
                <div class="d-flex flex-wrap gap-2 mb-4">
                  <button class="btn btn-primary" [disabled]="phone.stock === 0" (click)="addToCart(phone)">
                    <i class="bi bi-cart-plus me-1"></i> Select Quantity in Cart
                  </button>
                  <button class="btn btn-outline-primary" (click)="addToWishlist(phone)">
                    <i class="bi bi-heart me-1"></i> Add to Wishlist
                  </button>
                </div>
                
                <!-- Cart Quantity Indicator -->
                <div class="mb-3 d-inline-block">
                  <span class="badge bg-success p-2 fs-6">
                    <i class="bi bi-cart-check me-1"></i>
                    In cart: {{ cartQuantity }}
                  </span>
                </div>

                <!-- Reviews Section -->
                <div class="mt-4">
                  <h4 class="mb-3">Reviews</h4>
                  
                  <div *ngIf="reviews.length === 0" class="alert alert-light">
                    No reviews yet. Be the first to leave a review!
                  </div>

                  <!-- Review List -->
                  <app-review-item
                    *ngFor="let review of reviews"
                    [review]="review"
                    [sellerId]="phone.sellerId"
                    [currentUserId]="currentUserId"
                    (visibilityChange)="toggleReviewVisibility($event.reviewId, $event.hidden)"
                  ></app-review-item>

                  <!-- Show More Reviews Button -->
                  <button *ngIf="reviews.length < totalReviews" class="btn btn-outline-secondary mt-2" (click)="loadMoreReviews()">
                    Show More Reviews
                  </button>

                  <!-- Add Review Form -->
                  <div class="card mt-4">
                    <div class="card-body">
                      <h5 class="card-title">Write a Review</h5>
                      <div class="mb-3">
                        <label for="ratingSelect" class="form-label">Rating</label>
                        <select class="form-select" id="ratingSelect" [(ngModel)]="newReviewRating">
                          <option [value]="0" selected disabled>Select rating</option>
                          <option [value]="5">5 - Excellent</option>
                          <option [value]="4">4 - Very Good</option>
                          <option [value]="3">3 - Good</option>
                          <option [value]="2">2 - Fair</option>
                          <option [value]="1">1 - Poor</option>
                        </select>
                      </div>
                      <div class="mb-3">
                        <label for="reviewComment" class="form-label">Your Review</label>
                        <textarea class="form-control" id="reviewComment" rows="3" 
                                  placeholder="Write your review here..." 
                                  [(ngModel)]="newReviewComment"></textarea>
                      </div>
                      <button class="btn btn-primary" (click)="submitReview()" 
                              [disabled]="!currentUserId || newReviewRating === 0 || !newReviewComment.trim() || hasReviewed || isSeller">
                        Submit Review
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Quantity Selection Modal -->
<div *ngIf="showQuantityModal">
  <div class="modal-backdrop fade show"></div>
  <div class="modal d-block" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Select Quantity</h5>
          <button type="button" class="btn-close" aria-label="Close" (click)="cancelAddToCart()"></button>
        </div>
        <div class="modal-body d-flex align-items-center justify-content-center">
          <button class="btn btn-outline-secondary" (click)="decreaseQuantity()" [disabled]="selectedQuantity<=0">-</button>
          <span class="mx-3">{{ selectedQuantity }}</span>
          <button class="btn btn-outline-secondary" (click)="increaseQuantity()" [disabled]="selectedQuantity>=maxQuantity">+</button>
        </div>
        <div class="modal-body text-center mt-2">
          <small class="text-muted" *ngIf="selectedQuantity === 0">Setting quantity to 0 will remove the item from your cart</small>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="cancelAddToCart()">Cancel</button>
          <button type="button" class="btn btn-primary" (click)="confirmAddToCart()">
            {{ selectedQuantity === 0 ? 'Remove from Cart' : 'Confirm' }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div> 